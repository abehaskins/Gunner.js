var Cannon=function(a){this.url=a,this.reloaderStrs={},this.projectileStr="*",this.rawData=[],this.fetches=0,this.delayInt=0;var b,c=this;return this.fire=function(a){c._fetch(a)},this.rapidfire=function(a){c._fetch(function(b){c._each(b,function(b){a(b)})})},this.reloader=function(a){return c.reloaderStrs=a,c},this.limit=function(a){return c.limitInt=a,c},this.fetcher=function(a){return c.fetcherFunc=a,c},this.delay=function(a){return c.delayInt=a,c},this.projectile=function(a){return c.projectileStr=a,c},this.recoil=function(a){return c._getField(c.rawData,c.projectileStr,a)},this._fetch=function(a,b,d){return c.limitInt&&c.fetches++==c.limitInt?(a(b,c),void 0):(c.fetcherFunc&&c.fetcherFunc(c.fetches,c.limitInt),d=d?d:{},this._getURL(c.url,d,a).then(this._processIncoming),void 0)},this._processIncoming=function(a,d){c.rawData.push(a);var e=c._getField([a],c.projectileStr);b||(b=[]),this._each(e,function(a){b.push(a)}),this._reload(a,d)},this._reload=function(a,d){var e={},f=!1;for(var g in c.reloaderStrs){{c.reloaderStrs[g]}e[g]=c._getField([a],c.reloaderStrs[g])[0],f=e[g]||f}return f?(setTimeout(function(){c._fetch(d,b,e)},c.delayInt),void 0):(d(b,c),void 0)},this._getField=function(a,b,d){for(var e=b.split("."),f=[],g=[],h=function(a,b){g.push(a),a==d&&f.push(b)},i=0;i<e.length;i++){var j=e[i];g=[];for(var k=0;k<a.length;k++){var l=a[k];"*"==j?c._each(l,h):l[j]&&(g.push(l[j]),l[j]==d&&f.push(l))}a=g}return d?f:a},this._each=function(a,b){var d;if(c._isArray(a))for(d=0;d<a.length;d++)b(a[d],a,d);else for(d in a)b(a[d],a,d)},this._getURL=function(a,b,d){function e(a){f.resolve(JSON.parse(a.responseText||a.currentTarget.responseText),d)}var f=c._defer(),g=[],h="";for(var i in b)g.push(i+"="+b[i]);g.length&&(h="?"+g.join("&"));var j=new XMLHttpRequest;return j.onload=e,j.open("get",a+h,!0),j.send(),f.promise},this._defer=function(){var a={};return a.promise={then:function(b){a.callback=b,a.resolved&&a.finish()}},a.resolve=function(){a.args=arguments,a.callback&&a.finish(),a.resolved=!0},a.finish=function(){a.callback.apply(c,a.args)},a},this._isArray=function(a){return"[object Array]"==toString.call(a)},this};